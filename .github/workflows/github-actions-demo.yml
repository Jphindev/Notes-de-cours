#This file must got to {repo}/.github/workflows/

name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
on: #[push] #the event that will trigger the workflow or with more details:
  push:
    branches:
      - ghactions-demo
      - "!features/**" #excluding branches with filters
    tags-ignore: #excluding tags
      - v2
      - v1.*
    paths:
      - "**.yml" #including files with filters
  label:
    types:
      - deleted
  schedule:
    - cron: "30 5,17 28 2 1,3" # minutes hours day month day name
    #at 5h30 or 17h30 on the 28th day of february on a monday or wednesday

env: #global variables here, available for the entire workflow
  DAY_OF_WEEK: Monday

jobs:
  #GITHUB REFS
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v4 #checkout the repository to allow to run scripts relative to its code
      - uses: actions/setup-node@v4 #install node to use node and npm commands
        with:
          node-version: "20"
      - run: npm install bats
      - run: npx bats -v
      - run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "🖥️ The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "🍏 This job's status is ${{ job.status }}."

  #GITHUB VARIABLES
  Variables:
    runs-on: ubuntu-latest
    env: #variables here are only available for this job
      Greeting: Hello
    steps:
      - name: Display local variables using env.VAR or $VAR
        if: ${{ env.DAY_OF_WEEK == 'Monday' }}
        run: echo "$Greeting $First_Name. Today is $DAY_OF_WEEK!" #Hello Mona. Today is Monday!
        env: #variables here are only available for this step
          First_Name: Mona
      - name: Display variable defined in github options using vars.VARNAME
        run: echo "${{ vars.SUPERVAR }}" #run: execute a command on the runner
      - name: Retrieve a secret variable defined in github using secrets.VARSECRET
        env:
          super_secret: ${{ secrets.SUPERSECRET }}
        run: |
          echo "$super_secret"

  dep-job-1-setup:
    # Calling a reusable workflow:
    # uses: ./.github/workflows/reusable-workflow.yml
    # uses: github.com/{owner}/{repo}/.github/workflows/reusable-workflow.yml
    runs-on: ubuntu-latest
    steps:
      - run: echo "Setup job done"
  dep-job-2-build:
    needs: dep-job-1-setup #the build job will run only after the setup job, not in parallel
    runs-on: ubuntu-latest
    steps:
      - run: echo "Build job done"
  dep-job-3-test:
    needs: dep-job-2-build
    strategy:
      matrix: #to test the code in multiple versions of a language or on multiple operating systems
        os: [ubuntu-latest, windows-latest, macos-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - run: echo "Test job done on ${{ matrix.os }}"

  triage:
    #condition on the job
    if: >-
      github.event_name == 'push' && 
      github.actor != 'dependabot[bot]'
    runs-on: ubuntu-latest
    steps:
      - if: github.actor == 'Jphindev' #condition on the step
        run: echo "Triage job done"
